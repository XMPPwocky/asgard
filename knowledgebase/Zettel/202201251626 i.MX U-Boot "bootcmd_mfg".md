Can be very useful to bypass [[Secure boot]] (HAB) on [[i.MX (SoC)]] 

NXP/ has their own custom [[U-Boot (bootloader)]] fork, and it runs a *different bootcmd* when U-Boot itself detects it's been loaded over [[Universal Serial Bus]] (not from flash). AFAIK you can't (or just don't usually want to) turn off USB boot entirely...

Because it's common to set U-Boot up as "run these commands, if they fail then hard-reset or deadloop"...but running *different* commands that often don't have a reset/loop at the end ([[fastboot (Boot protocol)|fastboot]] iirc is the default, which can be interrupted with Ctrl-C) can often drop you right into a U-Boot shell!

https://github.com/Freescale/u-boot-fslc/blob/31cf6b483b580898c7387ed97e69304ea8cc7c96/common/autoboot.c#L352

```c
	if (is_boot_from_usb() && env_get("bootcmd_mfg")) {
		disconnect_from_pc();
		printf("Boot from USB for mfgtools\n");
		bootdelay = 0;
		env_set_default("Use default environment for \
				 mfgtools\n", 0);
	} else if (is_boot_from_usb()) {
		printf("Boot from USB for uuu\n");
		env_set("bootcmd", "fastboot 0");
	} else {
		printf("Normal Boot\n");
	}
```

Note that `is_boot_from_usb` here returns whether *U-Boot itself* was loaded over USB. This is key - because HAB will still require U-Boot to be validly signed. But in this case, you're loading the *unmodified* U-Boot, the same binary that's in flash... it just *behaves differently when loaded over USB*. [[202201260921 Digital signatures need context]]

"Over USB" here refers to [[Universal Update Utility (i.MX tool)]]

# Flashcards #flashcards 

The special U-Boot environment variable used by i.MX U-Boot when loaded over USB is called::`bootcmd_mfg`
<!--SR:!2022-03-15,31,250-->